<!doctype html>
<html>

<head>
  <script src="jsPsych/tests&examples/js/jquery.min.js"></script>
  <script src="jsPsych/tests&examples/js/jquery-ui.min.js"></script>
  <script src="rating_module.js"></script>
  <script src="jsPsych/jspsych.js"></script>
  <script src="jsPsych/plugins/jspsych-rating.js"></script>
  <script src="jsPsych/plugins/jspsych-survey-likert.js"></script>
  <script src="jsPsych/plugins/jspsych-forcedchoice.js"></script>
  <script src="jsPsych/plugins/jspsych-call-function.js"></script>
  <link rel="stylesheet" href="jsPsych/css/jspsych.css"></link>
  <link rel="stylesheet" href="jsPsych/tests&examples/css/jquery-ui.css"></link>
  <style>
    img {
      width: 300px;
    }
  </style>
</head>

<body>
  <div id="jspsych-target"></div>
</body>
<script>
	
	var trial_1 = {
	    stimulus: 'img/happy_face_1.jpg',
	  }

	  var trial_2 = {
	    stimulus: 'img/sad_face_1.jpg',
	  }

	  var trial_3 = {
	    stimulus: '<p>:)</p>',
	    is_html: true
	  }
	
	var likert_scale = ["1. Disagree strongly", "2. Disagree moderately", "3. Disagree a little","4. Neither agree nor disagree"
	   				 ,"5. Agree a little","6. Agree moderately","7. Agree strongly"]
	
	var likert_survey_trial = {
	    type: 'survey-likert',
	    questions : ["1. I see myself as extraverted, enthusiastic. ", "2. I see myself as critical, quarrelsome.",
	    "3. I see myself as dependable, self-disciplined. ","4. I see myself as anxious, easily upset. ", 
	    "5. I see myself as open to new experiences, complex ","6. I see myself as reserved, quiet. ",
	    "7. I see myself as sympathetic, warm. ","8. I see myself as disorganized, careless ",
	    "9. I see myself as calm, emotionally stable.","10. I see myself as conventional, uncreative."],
	    labels: [likert_scale,likert_scale,likert_scale,likert_scale,likert_scale,likert_scale,likert_scale,likert_scale,likert_scale,likert_scale]
	}
  //Global object that will hold the pairs of artwork. forced-choice trials will fetch their stimuli from here dynamically using simple array index with jsPsych's functions-as-plugin-params
  var choiceTimeline;
  var forcedChoiceTrialCounter = 0; 
  
  var node = {
    type: 'rating',
    timing_stim: 0.500,
    timeline: [trial_1, trial_2, trial_3],
    choices: [89, 78], // Y or N
    show_ticks : true,
    labels : ["-3","-2","-1","0","1","2","3"],
    prompt: '<p class="center-content">Do you like the piece of art?</p>',
    data: {
      node_data: true //??? why is that here?
    },
    // after every rating trial, assign the rating to the url of the image in the ImageRater
    on_finish: function(data){
    	if(data.rating !== null ){
    		ImageRater.rate(data.stimulus, data.rating);
    	}
    }
  }

  //A trial that does not do anything for the subject but builds the array of artwork pairs according to spec, to be used to get stimuli for the next phase
  var build_node = {
	type: "call-function",
	func: function(){
		choiceTimeline = ImageRater.getTimeline(20, [0], 1);
		if(choiceTimeline === false){
			jsPsych.endExperiment("Could not proceed with choice task");
		}
	}
  }
	
  //Represents the binary forced choice task block
  var forcedChoiceNode = {
	type: "forcedchoice",
	on_finish: function(data){
		forcedChoiceTrialCounter++;
	},
	timeline:[
		{stimuli: function(){return choiceTimeline[forcedChoiceTrialCounter]}}
	]
  }
  
  //load the artworks into the ImageRater
  ImageRater.loadList(["img/sad_face_1.jpg", "img/happy_face_1.jpg"]);
  
  jsPsych.init({
    display_element: $('#jspsych-target'),
    timeline: [likert_survey_trial,node, build_node, forcedChoiceNode],
    on_finish: function() {
      jsPsych.data.displayData();
    },
    default_iti: 250
  });
</script>

</html>